# –ò–º–ø–æ—Ä—Ç SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É –≤ AWS ACM –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ HTTPS listener –Ω–∞ ALB

## –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ AWS Console (–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π)

### –ö—Ä–æ–∫ 1: –û—Ç–∫—Ä–æ–π—Ç–µ AWS ACM Console

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: https://eu-central-1.console.aws.amazon.com/acm/home?region=eu-central-1
2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **"Import certificate"**

### –ö—Ä–æ–∫ 2: –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç

**Certificate body:**
```
-----BEGIN CERTIFICATE-----
[–≤—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–∑ certs/certificate.pem]
-----END CERTIFICATE-----
```

**Certificate private key:**
–ù—É–∂–µ–Ω –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –∏–∑ PFX. –ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç OpenSSL:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–Ω–ª–∞–π–Ω –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä: https://www.sslshopper.com/article-how-to-create-a-self-signed-certificate-html.html
- –ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (—Å–º. –°–ø–æ—Å–æ–± 2)

**Certificate chain:**
–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º (–¥–ª—è self-signed –Ω–µ –Ω—É–∂–Ω–∞)

### –ö—Ä–æ–∫ 3: –ó–∞–≤–µ—Ä—à–∏—Ç–µ –∏–º–ø–æ—Ä—Ç

–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **"Next"** ‚Üí **"Import"** ‚Üí —Å–∫–æ–ø—ñ—é–π—Ç–µ **Certificate ARN**

---

## –°–ø–æ—Å–æ–± 2: –°–æ–∑–¥–∞–µ–º —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ EC2 –∏–Ω—Å—Ç–∞–Ω—Å—ñ

–≠—Ç–æ –ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è production! –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –±—É–¥–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

### –ù–∞ –≤–∞—à–µ–º EC2 –∏–Ω—Å—Ç–∞–Ω—Å—ñ (connect —á–µ—Ä–µ–∑ SSH):

```bash
# –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–æ–º–∞—à–Ω—é—é –ø–∞–ø–∫—É
cd ~

# –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤
mkdir -p ~/ssl

# –ì–µ–Ω–µ—Ä—É—î–º–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (2048 –±–∏—Ç)
openssl genrsa -out ~/ssl/private.key 2048

# –ì–µ–Ω–µ—Ä—É—î–º–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç (365 –¥–Ω–µ–π –¥–µ–π—Å—Ç–≤–∏—è)
openssl req -new -x509 -key ~/ssl/private.key -out ~/ssl/certificate.crt -days 365 \
  -subj "/C=UA/ST=Kyiv/L=Kyiv/O=Secret Nick/CN=secret-nick.duckdns.org"

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ñ–∞–π–ª–∏
ls -la ~/ssl/
```

### –ö–æ–ø—ñ—é—î–º–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–º–ø—å—é—Ç–µ—Ä:

```bash
# –ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ (PowerShell):
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ AWS Session Manager –∏–ª–∏ SCP –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏–∑ EC2
```

---

## –°–ø–æ—Å–æ–± 3: –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π PFX —á–µ—Ä–µ–∑ Python –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é

–ï—Å–ª–∏ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Python:

```powershell
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ pyOpenSSL (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ)
pip install pyopenssl

# –°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç convert-pfx.py
```

```python
from OpenSSL import crypto
import sys

# –ó–∞–≥—Ä—É–∂–∞—î–º–æ PFX
pfx_file = 'certs/secret-nick.pfx'
pfx_password = b'SecretNick2025!'

with open(pfx_file, 'rb') as f:
    pfx_data = f.read()

# –ü–∞—Ä—Å–∏–º–æ PFX
p12 = crypto.load_pkcs12(pfx_data, pfx_password)

# –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—î–º–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç
cert_pem = crypto.dump_certificate(crypto.FILETYPE_PEM, p12.get_certificate())
with open('certs/certificate-export.pem', 'wb') as f:
    f.write(cert_pem)

# –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—î–º–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
key_pem = crypto.dump_privatekey(crypto.FILETYPE_PEM, p12.get_privatekey())
with open('certs/private-key-export.pem', 'wb') as f:
    f.write(key_pem)

print("‚úÖ Certificate: certs/certificate-export.pem")
print("‚úÖ Private Key: certs/private-key-export.pem")
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ:
```powershell
python convert-pfx.py
```

---

## –ü–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É –≤ ACM:

### –î–æ–±–∞–≤–ª—è–µ–º HTTPS listener –Ω–∞ ALB

1. **–û—Ç–∫—Ä–æ–π—Ç–µ AWS EC2 Console:**
   https://eu-central-1.console.aws.amazon.com/ec2/home?region=eu-central-1#LoadBalancers:

2. **–í—ã–±–µ—Ä—ñ—Ç—å ALB:**
   - –ù–∞–π–¥–∏—Ç–µ ALB (–Ω–∞–ø—Ä–∏–º–µ—Ä, `app-alb`)

3. **–î–æ–±–∞–≤—å—Ç–µ Listener:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **"Listeners and rules"**
   - –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **"Add listener"**

4. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è HTTPS Listener:**
   - Protocol: **HTTPS**
   - Port: **443**
   - Default action: **Forward** ‚Üí –≤—ã–±–µ—Ä—ñ—Ç—å –≤–∞—à Target Group (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è React/Angular/API)
   - SSL certificate: **From ACM** ‚Üí –≤—ã–±–µ—Ä—ñ—Ç—å –∏–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç
   - Security policy: **ELBSecurityPolicy-TLS13-1-2-2021-06**
   - –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **"Add"**

5. **–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ HTTP ‚Üí HTTPS (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
   - –í—ã–±–µ—Ä—ñ—Ç—å HTTP:80 listener
   - –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **"Edit"**
   - –ò–∑–º–µ–Ω–∏—Ç–µ Default action:
     - Type: **Redirect**
     - Protocol: **HTTPS**
     - Port: **443**
     - Status code: **HTTP 301**
   - –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **"Save changes"**

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è listener'–∞ (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-2 –º–∏–Ω—É—Ç—ã):

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
   ```
   https://secret-nick.duckdns.org
   ```

2. **–û–∂–∏–¥–∞–µ–º:**
   - ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–æ–º—É —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–µ (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
   - –°–∞–π—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É—Å—Ç–∏—Ç—å—Å—è —Å –∞–¥—Ä–µ—Å–æ–º HTTPS
   - –í –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –±—É–¥–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞—â–∏—â–µ–Ω–æ

3. **–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ ERR_CONNECTION_REFUSED:**
   - –ü–µ—Ä–µ–≤—ñ—Ä—ñ—Ç—å, —á—Ç–æ Security Group –ø–æ–∑–≤–æ–ª—è–µ—Ç port 443
   - –ü–µ—Ä–µ–≤—ñ—Ä—ñ—Ç—å, —á—Ç–æ listener –¥–æ–±–∞–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - –ó–∞—á–µ–∫–∞–π—Ç–µ 2-3 –º–∏–Ω—É—Ç—ã –Ω–∞ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

## –ö–ª—ñ—î–Ω—Ç—Å—å–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É

–ö–ª—ñ—î–Ω—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞ —É–≤–∏–¥—è—ÇË≠¶Âëä (warning) –æ —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–æ–º—É —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω –ø—Ä–∏–∑–Ω–∞–Ω–Ω–æ–π Certificate Authority.

–ï—Å–ª–∏ —Ö–æ—á–µ—Ç–µ —É–±—Ä–∞—Ç—å warning:
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Let's Encrypt** –Ω–∞ EC2 (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, –Ω–æ –Ω—É–∂–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ DNS)
2. –ò–ª–∏ –∫—É–ø–∏—Ç–µ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç
3. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **AWS Certificate Manager —Å –ø—É–±–ª–∏—á–Ω—ã–º –¥–æ–º–µ–Ω–æ–º** (—Ç—Ä–µ–±—É–µ—Ç Route53 –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏)

---

## –§–∏–Ω–∞–ª—å–Ω—ã–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ HTTPS:

1. **–û–±–Ω–æ–≤–∏—Ç–µ Cloudflare:**
   - SSL/TLS ‚Üí Overview ‚Üí **"Full"** (—Ç–∞–∫ –∫–∞–∫ ALB —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç HTTPS)

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ HTTPS:**
   - `curl -I https://secret-nick.duckdns.org`
   - –í –±—Ä–∞—É–∑–µ—Ä–µ: https://secret-nick.duckdns.org

3. **–ó–∞–∫–æ–º—ñ—Ç—å—Ç–µ –∑–º—ñ–Ω–∏:**
   ```
   git add .
   git commit -m "feat: add HTTPS support with self-signed certificate on ALB"
   git push marafon1 main
   ```

üéâ **–ì–æ—Ç–æ–≤–æ! –í–∞—à —Å–∞–π—Ç —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ HTTPS —Å —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–∏–º —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–æ–º!**
