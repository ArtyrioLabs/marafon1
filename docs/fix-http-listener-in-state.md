# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: HTTP Listener –≤—Å–µ –µ—â–µ –≤ Terraform state

## –ü—Ä–æ–±–ª–µ–º–∞

Terraform –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å `aws_lb_listener.http` –Ω–∞ –ø–æ—Ä—Ç—É 80, —Ö–æ—Ç—è –ø—Ä–∏ `enable_https = true` –æ–Ω –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è. Listener –≤—Å–µ –µ—â–µ –≤ state, —Ö–æ—Ç—è –±—ã–ª —É–¥–∞–ª–µ–Ω –∏–∑ AWS.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –£–¥–∞–ª–∏—Ç—å listener –∏–∑ state –≤—Ä—É—á–Ω—É—é

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ GitHub Actions (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

–®–∞–≥ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.github/workflows/infra-deploy.yml`. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç listener –∏–∑ state.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω–æ (–≤—Ä—É—á–Ω—É—é)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å–µ–π—á–∞—Å:

```bash
cd terraform
terraform init
terraform state rm 'module.alb.aws_lb_listener.http'
terraform state rm 'module.alb.aws_lb_listener_rule.http_api_forward'
terraform plan  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
terraform apply  # –ü—Ä–∏–º–µ–Ω–∏—Ç—å
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ AWS Console (—É–¥–∞–ª–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–π listener)

–ï—Å–ª–∏ listener —É–∂–µ —Å–æ–∑–¥–∞–Ω –Ω–∞ –ø–æ—Ä—Ç—É 80:

1. **AWS Console** ‚Üí **EC2** ‚Üí **Load Balancers** ‚Üí **app-alb** ‚Üí **Listeners**
2. –ù–∞–π–¥–∏—Ç–µ listener –Ω–∞ **–ø–æ—Ä—Ç—É 80** —Å —Ç–∏–ø–æ–º **"forward"** (–Ω–µ "redirect")
3. –£–¥–∞–ª–∏—Ç–µ –µ–≥–æ
4. –ó–∞—Ç–µ–º —É–¥–∞–ª–∏—Ç–µ –∏–∑ state (–í–∞—Ä–∏–∞–Ω—Ç 2)
5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `terraform apply` —Å–Ω–æ–≤–∞

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ state:

```bash
terraform state list | grep "aws_lb_listener.http"
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ (–∏–ª–∏ —Ç–æ–ª—å–∫–æ `http_redirect[0]`).

---

## üìù –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ?

1. `aws_lb_listener.http` –±—ã–ª —Å–æ–∑–¥–∞–Ω, –∫–æ–≥–¥–∞ `enable_https = false`
2. –í—ã –∏–∑–º–µ–Ω–∏–ª–∏ `enable_https = true` –≤ `terraform.tfvars`
3. Listener –±—ã–ª —É–¥–∞–ª–µ–Ω –≤—Ä—É—á–Ω—É—é –∏–∑ AWS
4. –ù–æ –æ–Ω –æ—Å—Ç–∞–ª—Å—è –≤ Terraform state
5. Terraform –≤–∏–¥–∏—Ç, —á—Ç–æ listener –µ—Å—Ç—å –≤ state, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ AWS
6. Terraform –ø—ã—Ç–∞–µ—Ç—Å—è –µ–≥–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å
7. –ù–æ —Ç–∞–∫–∂–µ –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å `http_redirect[0]` –Ω–∞ —Ç–æ–º –∂–µ –ø–æ—Ä—Ç—É
8. –ö–æ–Ω—Ñ–ª–∏–∫—Ç!

---

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü—Ä–∏ `enable_https = true`:
- ‚ùå `aws_lb_listener.http` –ù–ï —Å–æ–∑–¥–∞–µ—Ç—Å—è (count = 0)
- ‚úÖ `aws_lb_listener.http_redirect[0]` —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 80 (redirect)
- ‚úÖ `aws_lb_listener.https[0]` —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 443 (HTTPS)

---

## üéØ –ò—Ç–æ–≥

1. ‚úÖ –£–¥–∞–ª–∏—Ç—å listener –∏–∑ state
2. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å terraform apply
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–æ–∑–¥–∞–Ω —Ç–æ–ª—å–∫–æ redirect listener –Ω–∞ –ø–æ—Ä—Ç—É 80

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—Å–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å! üéâ

