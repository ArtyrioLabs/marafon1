# üîí –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã "–ù–µ –∑–∞—â–∏—â–µ–Ω–æ" –¥–ª—è DuckDNS + Cloudflare

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–ë—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ "–ù–µ –∑–∞—â–∏—â–µ–Ω–æ" (Not secure) –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ `https://secret-nick.duckdns.org`

## üîç –ü—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã

1. **DNS –∑–∞–ø–∏—Å–∏ –≤ Cloudflare –Ω–µ –≤ —Ä–µ–∂–∏–º–µ Proxied** (—Å–∞–º–∞—è —á–∞—Å—Ç–∞—è –ø—Ä–∏—á–∏–Ω–∞)
2. **SSL —Ä–µ–∂–∏–º –≤ Cloudflare —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ** (Off –∏–ª–∏ Flexible –≤–º–µ—Å—Ç–æ Full)
3. **Always Use HTTPS –Ω–µ –≤–∫–ª—é—á–µ–Ω** –≤ Cloudflare
4. **DuckDNS –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ nameservers**, –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–∞ –æ—Å–æ–±–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS –∑–∞–ø–∏—Å–∏ –≤ Cloudflare

1. –í–æ–π–¥–∏—Ç–µ –≤ [Cloudflare Dashboard](https://dash.cloudflare.com)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω `secret-nick.duckdns.org`
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **DNS** ‚Üí **Records**
4. –ù–∞–π–¥–∏—Ç–µ A –∑–∞–ø–∏—Å—å –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
- **Proxy status** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **Proxied** (–æ—Ä–∞–Ω–∂–µ–≤–∞—è —Ö–º–∞—Ä–∫–∞ ‚òÅÔ∏è)
- –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —Å–µ—Ä—É—é —Ö–º–∞—Ä–∫—É (DNS only), –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ—ë –∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ –Ω–∞ **Proxied**

**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
```
Type: A
Name: @ (–∏–ª–∏ secret-nick)
Content: IP_–≤–∞—à–µ–≥–æ_ALB (–Ω–∞–ø—Ä–∏–º–µ—Ä, 3.124.207.23)
Proxy status: ‚òÅÔ∏è Proxied (–û–†–ê–ù–ñ–ï–í–ê–Ø —Ö–º–∞—Ä–∫–∞)
TTL: Auto
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL —Ä–µ–∂–∏–º –≤ Cloudflare

1. –í Cloudflare Dashboard –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SSL/TLS**
2. –í —Ä–∞–∑–¥–µ–ª–µ **Overview** –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:
   - ‚úÖ **Full** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) - Cloudflare ‚ÜîÔ∏è Origin –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SSL, –Ω–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º
   - ‚úÖ **Full (strict)** - —Ç—Ä–µ–±—É–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ
   - ‚ùå **Flexible** - –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ! (—Ç–æ–ª—å–∫–æ Cloudflare ‚ÜîÔ∏è Browser, –Ω–µ Origin)
   - ‚ùå **Off** - –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ!

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—ã–±–µ—Ä–∏—Ç–µ **Full** –¥–ª—è –Ω–∞—á–∞–ª–∞

### –®–∞–≥ 3: –í–∫–ª—é—á–∏—Ç–µ Always Use HTTPS

1. –í Cloudflare Dashboard –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SSL/TLS** ‚Üí **Edge Certificates**
2. –ù–∞–π–¥–∏—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å **"Always Use HTTPS"**
3. –í–∫–ª—é—á–∏—Ç–µ –µ–≥–æ (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–∏–Ω–∏–º)
4. –≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç HTTP ‚Üí HTTPS

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DuckDNS

1. –í–æ–π–¥–∏—Ç–µ –Ω–∞ [duckdns.org](https://www.duckdns.org)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à –¥–æ–º–µ–Ω `secret-nick` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π IP:
   - IP –≤–∞—à–µ–≥–æ AWS ALB (–º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ AWS Console ‚Üí EC2 ‚Üí Load Balancers)
   - –ò–ª–∏ IP –≤–∞—à–µ–≥–æ EC2 –∏–Ω—Å—Ç–∞–Ω—Å–∞

### –®–∞–≥ 5: –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞

1. –ù–∞–∂–º–∏—Ç–µ `Ctrl + Shift + Delete` (Windows) –∏–ª–∏ `Cmd + Shift + Delete` (Mac)
2. –í—ã–±–µ—Ä–∏—Ç–µ "–ö–µ—à" –∏ "Cookies"
3. –û—á–∏—Å—Ç–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ
4. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∂–∏–º –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS propagation

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ:
```bash
nslookup secret-nick.duckdns.org
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ï—Å–ª–∏ DNS –∑–∞–ø–∏—Å–∏ –≤ Cloudflare –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å Proxied, –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å IP –∞–¥—Ä–µ—Å–∞ Cloudflare (–Ω–∞–ø—Ä–∏–º–µ—Ä, `104.x.x.x` –∏–ª–∏ `172.x.x.x`)
- –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ IP –≤–∞—à–µ–≥–æ ALB –Ω–∞–ø—Ä—è–º—É—é, –∑–Ω–∞—á–∏—Ç Cloudflare –Ω–µ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç —Ç—Ä–∞—Ñ–∏–∫

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –æ–Ω–ª–∞–π–Ω —Å–µ—Ä–≤–∏—Å—ã:**
- [whatsmydns.net](https://www.whatsmydns.net/#A/secret-nick.duckdns.org)
- [dnschecker.org](https://dnschecker.org/#A/secret-nick.duckdns.org)

---

## üîß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Origin Certificate

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Cloudflare Origin Certificate:

### –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ Origin Certificate –≤ Cloudflare

1. –í Cloudflare Dashboard: **SSL/TLS** ‚Üí **Origin Server**
2. –ù–∞–∂–º–∏—Ç–µ **"Create Certificate"**
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
   - **Private key type:** RSA (2048)
   - **Hostnames:** 
     - `secret-nick.duckdns.org`
     - `*.secret-nick.duckdns.org` (–¥–ª—è –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤)
   - **Certificate Validity:** 15 years
4. –ù–∞–∂–º–∏—Ç–µ **"Create"**
5. **–í–ê–ñ–ù–û:** –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ:
   - **Origin Certificate** (cert.pem)
   - **Private Key** (key.pem)

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞ ALB (—á–µ—Ä–µ–∑ ACM)

1. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ —Ñ–∞–π–ª—ã:
   ```powershell
   # –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ certs/cloudflare-cert.pem
   # –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ certs/cloudflare-key.pem
   ```

2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ AWS Certificate Manager:
   ```powershell
   aws acm import-certificate `
     --certificate fileb://certs/cloudflare-cert.pem `
     --private-key fileb://certs/cloudflare-key.pem `
     --region eu-central-1 `
     --tags Key=Name,Value=secret-nick-cloudflare-ssl
   ```

3. –ü–æ–ª—É—á–∏—Ç–µ Certificate ARN:
   ```powershell
   aws acm list-certificates --region eu-central-1
   ```

4. –û–±–Ω–æ–≤–∏—Ç–µ terraform.tfvars:
   ```hcl
   enable_https = true
   # certificate_arn –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∏–∑ –º–æ–¥—É–ª—è dns_ssl
   ```

5. –ò–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ ALB listener –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ AWS Console

### –®–∞–≥ 3: –ò–∑–º–µ–Ω–∏—Ç–µ SSL —Ä–µ–∂–∏–º –Ω–∞ Full (strict)

1. –í Cloudflare: **SSL/TLS** ‚Üí **Overview**
2. –í—ã–±–µ—Ä–∏—Ç–µ **"Full (strict)"**

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: DNS –≤—Å–µ –µ—â–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç IP ALB, –∞ –Ω–µ Cloudflare

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ Cloudflare DNS –∑–∞–ø–∏—Å–∏ –∏–º–µ—é—Ç —Å—Ç–∞—Ç—É—Å **Proxied** (–æ—Ä–∞–Ω–∂–µ–≤–∞—è —Ö–º–∞—Ä–∫–∞)
2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 5-15 –º–∏–Ω—É—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DNS
3. –û—á–∏—Å—Ç–∏—Ç–µ DNS –∫–µ—à:
   ```bash
   # Windows
   ipconfig /flushdns
   
   # Linux/Mac
   sudo systemd-resolve --flush-caches
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: Cloudflare –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É 521 (Web server is down)

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–∞—à ALB —Ä–∞–±–æ—Ç–∞–µ—Ç:
   ```bash
   curl -I http://–≤–∞—à-alb-dns-name.eu-central-1.elb.amazonaws.com
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Security Group:
   - –ü–æ—Ä—Ç 80 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç –¥–ª—è Cloudflare IP ranges
   - –î–æ–±–∞–≤—å—Ç–µ Cloudflare IP ranges: https://www.cloudflare.com/ips/

### –ü—Ä–æ–±–ª–µ–º–∞: Cloudflare –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É 525 (SSL handshake failed)

**–†–µ—à–µ–Ω–∏–µ:**
1. –ò–∑–º–µ–Ω–∏—Ç–µ SSL —Ä–µ–∂–∏–º –Ω–∞ **Full** (–Ω–µ strict)
2. –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Origin Certificate –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä/ALB

### –ü—Ä–æ–±–ª–µ–º–∞: –ë—Ä–∞—É–∑–µ—Ä –≤—Å–µ –µ—â–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ù–µ –∑–∞—â–∏—â–µ–Ω–æ"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `https://` (–Ω–µ `http://`)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ "Always Use HTTPS" –≤–∫–ª—é—á–µ–Ω –≤ Cloudflare
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä –∏–ª–∏ —Ä–µ–∂–∏–º –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ
4. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 15-30 –º–∏–Ω—É—Ç –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DNS –∏ SSL

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- [ ] DNS –∑–∞–ø–∏—Å–∏ –≤ Cloudflare –∏–º–µ—é—Ç —Å—Ç–∞—Ç—É—Å **Proxied** (–æ—Ä–∞–Ω–∂–µ–≤–∞—è —Ö–º–∞—Ä–∫–∞)
- [ ] SSL —Ä–µ–∂–∏–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ **Full** –∏–ª–∏ **Full (strict)**
- [ ] **Always Use HTTPS** –≤–∫–ª—é—á–µ–Ω
- [ ] DuckDNS –¥–æ–º–µ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π IP
- [ ] DNS propagation –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ nslookup)
- [ ] –ö–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ –æ—á–∏—â–µ–Ω
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ —Ä–µ–∂–∏–º –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ
- [ ] Security Group –æ—Ç–∫—Ä—ã—Ç –¥–ª—è Cloudflare IP ranges (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Cloudflare SSL Modes](https://developers.cloudflare.com/ssl/origin-configuration/ssl-modes/)
- [Cloudflare Origin CA certificates](https://developers.cloudflare.com/ssl/origin-configuration/origin-ca/)
- [Cloudflare IP Ranges](https://www.cloudflare.com/ips/)
- [SSL Labs Test](https://www.ssllabs.com/ssltest/) - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ SSL

---

## üéâ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:
1. –û—Ç–∫—Ä–æ–π—Ç–µ `https://secret-nick.duckdns.org` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è **–∑–∞–º–æ–∫** üîí –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
3. –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–¥–∞–Ω Cloudflare
4. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ "–ù–µ –∑–∞—â–∏—â–µ–Ω–æ" –¥–æ–ª–∂–Ω–æ –∏—Å—á–µ–∑–Ω—É—Ç—å

**–ü—Ä–æ–≤–µ—Ä–∫–∞ SSL –∫–∞—á–µ—Å—Ç–≤–∞:**
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://www.ssllabs.com/ssltest/
- –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω: `secret-nick.duckdns.org`
- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–µ–π—Ç–∏–Ω–≥ **A** –∏–ª–∏ **A+**

