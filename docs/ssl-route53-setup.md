# SSL/TLS Certificate Setup –∑ Route53 —Ç–∞ ACM

## üìã –ü–æ–∫—Ä–æ–∫–æ–≤–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è

### –ü–µ—Ä–µ–¥—É–º–æ–≤–∏

–£ –≤–∞—Å —î 2 –≤–∞—Ä—ñ–∞–Ω—Ç–∏:

1. **–í–∞—Ä—ñ–∞–Ω—Ç A (–®–í–ò–î–ö–ò–ô, –∞–ª–µ –∑ –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏):** –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ DuckDNS –∑ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–∏–º —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–æ–º
2. **–í–∞—Ä—ñ–∞–Ω—Ç B (–ü–†–ê–í–ò–õ–¨–ù–ò–ô, —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ):** –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ –¥–æ–º–µ–Ω –Ω–∞ eu.org —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ Route53

---

## üöÄ –í–∞—Ä—ñ–∞–Ω—Ç A: DuckDNS –∑ Let's Encrypt (—à–≤–∏–¥–∫–∏–π setup)

### –ö—Ä–æ–∫ 1: –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –ª–æ–∫–∞–ª—å–Ω–æ

–û—Å–∫—ñ–ª—å–∫–∏ DuckDNS –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î DNS validation, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ HTTP validation.

**–û–ø—Ü—ñ—è 1: –ß–µ—Ä–µ–∑ certbot (Linux/WSL):**

```bash
# –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å certbot (—è–∫—â–æ —â–µ –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ)
sudo apt-get update
sudo apt-get install certbot

# –ó–≥–µ–Ω–µ—Ä—É–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç
sudo certbot certonly --manual --preferred-challenges http \
  -d secret-nick.duckdns.org \
  --email your-email@example.com \
  --agree-tos \
  --no-eff-email
```

Certbot –ø–æ–ø—Ä–æ—Å–∏—Ç—å —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–π–ª –∑ —Ç–æ–∫–µ–Ω–æ–º –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó. –ü–æ—Ç—Ä—ñ–±–Ω–æ:
1. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–π–ª –Ω–∞ –≤–∞—à–æ–º—É –≤–µ–±-—Å–µ—Ä–≤–µ—Ä—ñ
2. –ó—Ä–æ–±–∏—Ç–∏ –π–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–∏–º –∑–∞ URL: `http://secret-nick.duckdns.org/.well-known/acme-challenge/TOKEN`

**–û–ø—Ü—ñ—è 2: –ß–µ—Ä–µ–∑ acme.sh (–ø—Ä–æ—Å—Ç—ñ—à–µ –¥–ª—è DuckDNS):**

```bash
# –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å acme.sh
curl https://get.acme.sh | sh

# –û—Ç—Ä–∏–º–∞–π—Ç–µ —Ç–æ–∫–µ–Ω DuckDNS (–∑ https://www.duckdns.org/)
export DuckDNS_Token="your-duckdns-token"

# –ó–≥–µ–Ω–µ—Ä—É–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç
acme.sh --issue --dns dns_duckdns -d secret-nick.duckdns.org
```

### –ö—Ä–æ–∫ 2: –Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –≤ AWS ACM

```bash
# –ü—ñ—Å–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É, —ñ–º–ø–æ—Ä—Ç—É–π—Ç–µ –≤ ACM
aws acm import-certificate \
  --certificate fileb://~/.acme.sh/secret-nick.duckdns.org/secret-nick.duckdns.org.cer \
  --private-key fileb://~/.acme.sh/secret-nick.duckdns.org/secret-nick.duckdns.org.key \
  --certificate-chain fileb://~/.acme.sh/secret-nick.duckdns.org/ca.cer \
  --region eu-central-1
```

–°–∫–æ–ø—ñ—é–π—Ç–µ –æ—Ç—Ä–∏–º–∞–Ω–∏–π `CertificateArn`.

### –ö—Ä–æ–∫ 3: –î–æ–¥–∞—Ç–∏ HTTPS listener –¥–æ ALB —á–µ—Ä–µ–∑ AWS Console

1. AWS Console ‚Üí EC2 ‚Üí Load Balancers
2. –í–∏–±–µ—Ä—ñ—Ç—å –≤–∞—à ALB (`app-alb-...`)
3. Listeners and rules ‚Üí Add listener
4. Protocol: **HTTPS**, Port: **443**
5. Default action: Forward to ‚Üí –≤–∏–±–µ—Ä—ñ—Ç—å target group (react –∞–±–æ backend)
6. Security policy: **ELBSecurityPolicy-TLS13-1-2-2021-06** (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)
7. Certificate: –≤–∏–±–µ—Ä—ñ—Ç—å —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç
8. Add

### –ö—Ä–æ–∫ 4: –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ HTTP ‚Üí HTTPS redirect

1. –í–∏–±–µ—Ä—ñ—Ç—å HTTP:80 listener
2. Edit rules
3. Default action: Redirect to HTTPS:443
4. Save

### –ö—Ä–æ–∫ 5: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ HTTPS

–í—ñ–¥–∫—Ä–∏–π—Ç–µ: https://secret-nick.duckdns.org

‚úÖ SSL –ø–æ–≤–∏–Ω–µ–Ω –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –±–µ–∑ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω—å!

**–ù–µ–¥–æ–ª—ñ–∫–∏:**
- –ü–æ—Ç—Ä—ñ–±–Ω–æ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –∫–æ–∂–Ω—ñ 90 –¥–Ω—ñ–≤ –≤—Ä—É—á–Ω—É
- –ù–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ Terraform

---

## ‚úÖ –í–∞—Ä—ñ–∞–Ω—Ç B: Route53 + eu.org –¥–æ–º–µ–Ω (–†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–û –¥–ª—è production)

### –ö—Ä–æ–∫ 1: –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π –¥–æ–º–µ–Ω –Ω–∞ eu.org

1. –ô–¥—ñ—Ç—å –Ω–∞ https://nic.eu.org/
2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **Register** ‚Üí **New Domain**
3. –í–≤–µ–¥—ñ—Ç—å –±–∞–∂–∞–Ω–µ —ñ–º'—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `marafon-app` ‚Üí –æ—Ç—Ä–∏–º–∞—î—Ç–µ `marafon-app.eu.org`)
4. –ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó
5. –ó–∞—á–µ–∫–∞–π—Ç–µ 1-2 –¥–Ω—ñ –Ω–∞ —Å—Ö–≤–∞–ª–µ–Ω–Ω—è (–æ—Ç—Ä–∏–º–∞—î—Ç–µ email)

### –ö—Ä–æ–∫ 2: –°—Ç–≤–æ—Ä–∏—Ç–∏ Route53 Hosted Zone

–ü—ñ—Å–ª—è —Å—Ö–≤–∞–ª–µ–Ω–Ω—è –¥–æ–º–µ–Ω—É:

1. **–û–Ω–æ–≤—ñ—Ç—å terraform.tfvars:**

```hcl
domain_name = "marafon-app.eu.org"  # –í–∞—à –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–π –¥–æ–º–µ–Ω
create_route53_zone = true
```

2. **–ó–∞–∫–æ–º—ñ—Ç—å—Ç–µ –∑–º—ñ–Ω–∏:**

```bash
git add terraform/terraform.tfvars
git commit -m "feat: enable Route53 for eu.org domain"
git push marafon1 main
```

3. **–ó–∞–ø—É—Å—Ç—ñ—Ç—å GitHub Actions workflow:**

- Workflow: `terraform AWS deployment`
- Module: `dns-ssl`
- Action: `apply`

4. **–°–∫–æ–ø—ñ—é–π—Ç–µ nameservers –∑ outputs:**

–ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è workflow, –∑–Ω–∞–π–¥—ñ—Ç—å –≤ outputs 4 nameservers (—â–æ—Å—å —Ç–∏–ø—É):
```
ns-123.awsdns-12.com
ns-456.awsdns-34.net
ns-789.awsdns-56.org
ns-012.awsdns-78.co.uk
```

### –ö—Ä–æ–∫ 3: –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ nameservers –≤ eu.org –ø–∞–Ω–µ–ª—ñ

1. –£–≤—ñ–π–¥—ñ—Ç—å –≤ https://nic.eu.org/
2. –í–∏–±–µ—Ä—ñ—Ç—å –≤–∞—à –¥–æ–º–µ–Ω ‚Üí **Edit**
3. –í —Ä–æ–∑–¥—ñ–ª—ñ **Name servers** –¥–æ–¥–∞–π—Ç–µ 4 nameservers –∑ Route53
4. Save

### –ö—Ä–æ–∫ 4: –ó–∞—á–µ–∫–∞—Ç–∏ –Ω–∞ DNS propagation (15-60 —Ö–≤–∏–ª–∏–Ω)

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ:

```bash
nslookup marafon-app.eu.org
```

–ü–æ–≤–∏–Ω–µ–Ω –ø–æ–∫–∞–∑–∞—Ç–∏ IP –∞–¥—Ä–µ—Å—É ALB.

### –ö—Ä–æ–∫ 5: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ ACM —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç

1. AWS Console ‚Üí Certificate Manager
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É –¥–ª—è `marafon-app.eu.org`
3. –°—Ç–∞—Ç—É—Å –ø–æ–≤–∏–Ω–µ–Ω –∑–º—ñ–Ω–∏—Ç–∏—Å—è –Ω–∞ **Issued** –ø—ñ—Å–ª—è DNS propagation

### –ö—Ä–æ–∫ 6: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ HTTPS

–í—ñ–¥–∫—Ä–∏–π—Ç–µ: https://marafon-app.eu.org

‚úÖ SSL –ø–æ–≤–∏–Ω–µ–Ω –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –≤–∞–ª—ñ–¥–Ω–∏–º —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–æ–º –±–µ–∑ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω—å!

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É (AWS ACM –∫–µ—Ä—É—î –∂–∏—Ç—Ç—î–≤–∏–º —Ü–∏–∫–ª–æ–º)
- –ü–æ–≤–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Terraform
- –í–∞–ª—ñ–¥–Ω–∏–π SSL –±–µ–∑ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω—å
- –ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –ø—ñ–¥–¥–æ–º–µ–Ω–∏ (api.marafon-app.eu.org, admin.marafon-app.eu.org)

---

## üõ†Ô∏è Troubleshooting

### –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –≤ —Å—Ç–∞—Ç—É—Å—ñ "Pending validation"

**–ü—Ä–∏—á–∏–Ω–∞:** DNS –∑–∞–ø–∏—Å –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —â–µ –Ω–µ propagated.

**–†—ñ—à–µ–Ω–Ω—è:**
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ nameservers –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –≤ eu.org –ø–∞–Ω–µ–ª—ñ
2. –ó–∞—á–µ–∫–∞–π—Ç–µ 15-60 —Ö–≤–∏–ª–∏–Ω
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ DNS propagation: https://www.whatsmydns.net/

### HTTPS –Ω–µ –ø—Ä–∞—Ü—é—î (–±—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∑—É—î "Connection refused")

**–ü—Ä–∏—á–∏–Ω–∞:** HTTPS listener –Ω–µ –¥–æ–¥–∞–Ω–æ –¥–æ ALB –∞–±–æ Security Group –±–ª–æ–∫—É—î –ø–æ—Ä—Ç 443.

**–†—ñ—à–µ–Ω–Ω—è:**
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –ø–æ—Ä—Ç 443 —î –≤ `alb_ingress_ports` –≤ terraform.tfvars
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ HTTPS listener –¥–æ–¥–∞–Ω–æ –¥–æ ALB (AWS Console ‚Üí Load Balancers)
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ Security Group rules (–º–∞—î –±—É—Ç–∏ ingress rule –¥–ª—è port 443)

### DNS –Ω–µ —Ä–µ–∑–æ–ª–≤–∏—Ç—å—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** A record –Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–æ –≤ Route53 –∞–±–æ nameservers –Ω–µ propagated.

**–†—ñ—à–µ–Ω–Ω—è:**
1. AWS Console ‚Üí Route53 ‚Üí Hosted zones ‚Üí –≤–∞—à –¥–æ–º–µ–Ω
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ —î A record (–∞–±–æ ALIAS record) –∑ –∞–¥—Ä–µ—Å–æ—é ALB
3. –ó–∞—á–µ–∫–∞–π—Ç–µ –Ω–∞ DNS propagation (–¥–æ 48 –≥–æ–¥–∏–Ω, –∑–∞–∑–≤–∏—á–∞–π 15-60 —Ö–≤–∏–ª–∏–Ω)

---

## üìä –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤

| –ü–∞—Ä–∞–º–µ—Ç—Ä | DuckDNS + Let's Encrypt | Route53 + eu.org |
|----------|------------------------|------------------|
| –ß–∞—Å setup | 30-60 —Ö–≤–∏–ª–∏–Ω | 1-2 –¥–Ω—ñ (—Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –¥–æ–º–µ–Ω—É) |
| –í–∞–ª—ñ–¥–Ω–∏–π SSL | ‚úÖ –¢–∞–∫ | ‚úÖ –¢–∞–∫ |
| –ê–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è | ‚ùå –ù—ñ (–∫–æ–∂–Ω—ñ 90 –¥–Ω—ñ–≤ –≤—Ä—É—á–Ω—É) | ‚úÖ –¢–∞–∫ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ AWS) |
| Terraform —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è | ‚ö†Ô∏è –ß–∞—Å—Ç–∫–æ–≤–æ (import –≤—Ä—É—á–Ω—É) | ‚úÖ –ü–æ–≤–Ω–∞ |
| –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å | –°–µ—Ä–µ–¥–Ω—è | –ù–∏–∑—å–∫–∞ (–ø—ñ—Å–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó) |
| –í–∞—Ä—Ç—ñ—Å—Ç—å | üÜì –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ | üÜì –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ |

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

- **–î–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è (—à–≤–∏–¥–∫–æ):** –í–∞—Ä—ñ–∞–Ω—Ç A (DuckDNS + Let's Encrypt)
- **–î–ª—è production:** –í–∞—Ä—ñ–∞–Ω—Ç B (Route53 + eu.org)

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω —à–≤–∏–¥–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞—Ä–∞–∑ - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –í–∞—Ä—ñ–∞–Ω—Ç A.
–Ø–∫—â–æ –º–æ–∂–µ—Ç–µ –ø–æ—á–µ–∫–∞—Ç–∏ 1-2 –¥–Ω—ñ - –∫—Ä–∞—â–µ –í–∞—Ä—ñ–∞–Ω—Ç B (–Ω–∞–±–∞–≥–∞—Ç–æ –ø—Ä–æ—Å—Ç—ñ—à–µ –≤ –ø—ñ–¥—Ç—Ä–∏–º—Ü—ñ).
